---
title: "DATA 624 - Final Project EDA"
author: "Oluwakemi Omotunde"
date: "April 21, 2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
This is role playing.  I am your new boss.  I am in charge of production at ABC Beverage and you are a team of data scientists reporting to me.  My leadership has told me that new regulations are requiring us to understand our manufacturing process, the predictive factors and be able to report to them our predictive model of PH.

Please use the historical data set I am providing.  Build and report the factors in BOTH a technical and non-technical report.I like to use Word and Excel.  Please provide your non-technical report in a business friendly readable document and your predictions in an Excel readable format. The technical report should show clearly the models you tested and how you selected your final approach.

```{r load data, echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE}
library(readxl)
bev <- read_excel("FinalTrain.xlsx")
```


## EXCEL

The first thing I did was to open the excel files for training and test data that was provided. This is just to get a general idea of what we are looking at. We first looked out the training data. We noticed that the column names had spaces so we formatted as xxx.xxxx, for easier acces to the columns. We have 1 response variable (PH) and 32 predictor variables(all numerical) with 2571 observation. One thing that I noticed immediately using the filter function was that we are missing about 120 of the predictor variable, "Brand Code". I also noticed that a couple(4) of our response variable, PH was also missing. Below is the summary statistic we obtained.

```{r load statistics, echo=FALSE}
library(knitr)
training.summary <- read_excel("FinalTrainStats.xlsx")
kable(training.summary)
```

Aside from the missing response variables, there are quite a bit of the predictor variables with missing values. MFR has a total of 212 missing values and some like "Pressure Vacuum" and "Air Pressure" have no missing values. We will go ahead a impute the missing values for the predictor variables. There are a few variables that I worry may have outliers because of the range between the min and the max. One such variable is "Carb Flow", with a min of 26 and max of 5104. Another would be MFR. 

`


```{r bev describe, echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE}
library(psych)
bev.des <- describe(bev, na.rm = TRUE, interp = FALSE, skew = TRUE, ranges = TRUE, trim = .1, type = 3, check = TRUE, fast = FALSE, quant = c(.25,.75), IQR = TRUE)
kable(bev.des)
```

The describe function from the psych package gives us a more descriptive summary statistic breakdown, inclduing skewness. We see that some variables are right skewed(PSC CO2, PSC Fill, and Temperature) while some are left skewed(Filler Speed, Carb Flow, and MFR). We will perform some transformations later. First, let's do some plots|further exploration of our predictors.

```{r plot predictors, echo=TRUE, message=FALSE, warning=FALSE, paged.print=FALSE}
library(DataExplorer)
#create_report(bev, y = "PH")
DataExplorer::plot_histogram(bev, nrow = 3L, ncol = 4L)
```

Looking at the plots, a few things jump out immediately at me. It doesn't appear that a lot of the variables have a normal distribution A phew of them have spikes that I think might be outliers and will be explored further. We will definitely need to do some pre-processing before throughing into a model. I'd like to take a look at the correlation plots to see if we have highly correlated date. We will remove those that are. 

```{r correlation, message=TRUE, warning=TRUE, paged.print=TRUE}
library(ggplot2)
plot_correlation(bev, type = c("all", "discrete", "continuous"),
  maxcat = 20L, cor_args = list(), geom_text_args = list(),
  title = NULL, ggtheme = theme_gray(),
  theme_config = list(legend.position = "bottom", axis.text.x =
  element_text(angle = 90)))
```

As we stated earlier, Brand Code was missing about 120 variables. We will replace the blanks(N/A's) with U for UNKNOWN. We will then use the mice package to impute the remaining missing values.

```{r imputations, message=TRUE, warning=TRUE, paged.print=TRUE}
library(mice)
library(VIM)
md.pattern(bev)
aggr_plot <- aggr(bev, col=c('navyblue','red'), numbers = TRUE, sortVars = TRUE, labels = colnames(bev), cex.axis = .7, gap = 3, ylab =c ("Histogram of missing data","Pattern"))

#bev$Brand.Code[bev$Brand.Code == ""] <- "U"

bev.imp <- mice(bev, m =3, maxit =3, print = FALSE, seed = 234)
densityplot(bev.imp)

bev <- complete(bev.imp)
```
Unfortunately, the code to replace the blanks in the Brand.Code column so we went back to Excel to help us out. We filterd for the blanks in the column and filled in a "U". 

```{r split data, message=TRUE, warning=TRUE, paged.print=TRUE}
library(caret)
set.seed(123)
sample <- sample.int(n = nrow(bev), size = floor( .75 * nrow(bev)), replace = FALSE)
bev_train <- bev[sample, ]
bev_test <- bev[-sample, ]

myControl <- trainControl(method = 'cv', number = 5, verboseIter = FALSE, savePredictions = TRUE, allowParallel = TRUE)
```


```{r GLM MODEL, message=TRUE, warning=TRUE, paged.print=TRUE}
set.seed(456)
glm.model <- train(PH ~., data = bev_train, metric = "RMSE", method = "glm", preProcess = c("center", "scale", "BoxCox"), trControl = myControl)

glm.rmse <- glm.model$results$RMSE

paste0("The RMSE value for the GLM model is ", glm.rmse)
```

```{r glmnet model, message=TRUE, warning=TRUE, paged.print=TRUE}
set.seed(789)
glmnet.model <- train(PH ~., data = bev_train, metric = "RMSE", method = "glmnet", preProcess = c("center", "scale", "BoxCox"), trControl = myControl)

glmnet.model
```
The best RMSE value for the GLMNET model is when alpha = 1 and lambda = .0001541044, .1328577. 

We will next try partial least squares regression model.
```{r partial least squares, message=TRUE, warning=TRUE, paged.print=TRUE}
pls.bev <- train(PH ~., data = bev_train, metric = "RMSE", method = "pls", tunelength = 15, preProcess = c("center", "scale", "BoxCox"), trControl = myControl)

pls.bev
```
The results show the RMSE value of .1390284, when ncomp is 3. We will lastly try a random forest model. 

```{r random forest, message=TRUE, warning=TRUE, paged.print=TRUE}
ctrl <- trainControl(method = "repeatedcv", number = 5, repeats = 2, search = "random", allowParallel = TRUE)
mtry <- sqrt(ncol(bev_train))

set.seed(321)
ranfor.bev <- 
```

